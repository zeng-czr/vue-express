{"remainingRequest":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\eslint-loader\\index.js??ref--14-0!C:\\Users\\ht\\Desktop\\vue-express\\src\\router\\permission\\index.js","dependencies":[{"path":"C:\\Users\\ht\\Desktop\\vue-express\\src\\router\\permission\\index.js","mtime":1696240843715},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\babel.config.js","mtime":1696052669664},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1696052662415},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\babel-loader\\lib\\index.js","mtime":1696052663280},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\eslint-loader\\index.js","mtime":1696052662632}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHJvdXRlciBmcm9tICdAL3JvdXRlci9pbmRleC5qcyc7Ci8vIGltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tICdlbGVtZW50LXVpJwppbXBvcnQgTlByb2dyZXNzIGZyb20gJ25wcm9ncmVzcyc7CmltcG9ydCAnbnByb2dyZXNzL25wcm9ncmVzcy5jc3MnOwppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJ0AvdXRpbHMvYXV0aC5qcyc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKTlByb2dyZXNzLmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOwovLyDnmb3lkI3ljZUtLeaJgOacieadg+mZkOWdh+WPr+iuv+mXrueahOmhtemdoi0t55m75b2V5ZKM5rOo5YaMCmNvbnN0IHdoaXRlTGlzdCA9IFsnL2xvZ2luJywgJy9yZWdpc3RlciddOwpyb3V0ZXIuYmVmb3JlRWFjaChhc3luYyAodG8sIGZyb20sIG5leHQpID0+IHsKICAvKiBtdXN0IGNhbGwgYG5leHRgICovCiAgTlByb2dyZXNzLnN0YXJ0KCk7CiAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbigpOwogIGNvbnNvbGUubG9nKHRva2VuKTsKICBpZiAodG9rZW4pIHsKICAgIGlmICh0by5wYXRoID09PSAnL2xvZ2luJykgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnLycKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBoYXNSb2xlcyA9IHN0b3JlLmdldHRlcnMucm9sZXMgJiYgc3RvcmUuZ2V0dGVycy5yb2xlcy5sZW5ndGggPiAwOwogICAgICBpZiAoaGFzUm9sZXMpIHsKICAgICAgICBuZXh0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHN0b3JlLmRpc3BhdGNoKCd1c2VyL2dldEluZm8nKTsKICAgICAgICBjb25zdCByb2xlcyA9IGRhdGE7CiAgICAgICAgY29uc3QgYWNjZXNzZWRSb3V0ZXMgPSBhd2FpdCBzdG9yZS5kaXNwYXRjaCgncGVybWlzc2lvbi9nZW5lcmF0ZVJvdXRlcycsIHJvbGVzKTsKICAgICAgICBjb25zb2xlLmxvZyhhY2Nlc3NlZFJvdXRlcyk7CiAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhhY2Nlc3NlZFJvdXRlcyk7CiAgICAgICAgbmV4dCh7CiAgICAgICAgICAuLi50bywKICAgICAgICAgIHJlcGxhY2U6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLy8gY29uc3Qgcm9sZXMgPSBzdG9yZS5nZXR0ZXJzWyd1c2VyJywgJ3JvbGVzCiAgICAvLyByZXNldFJvdXRlcigpCiAgICAvLyBjb25zb2xlLmxvZyhyb3V0ZXIpCiAgfSBlbHNlIHsKICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgbmV4dCgpOwogICAgfSBlbHNlIHsKICAgICAgbmV4dChgL2xvZ2luP3JlZGlyZWN0PSR7dG8ucGF0aH1gKTsKICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgIH0KICB9Cn0pOwpyb3V0ZXIuYWZ0ZXJFYWNoKCgpID0+IHsKICBOUHJvZ3Jlc3MuZG9uZSgpOwp9KTs="},{"version":3,"names":["router","NProgress","getToken","store","configure","showSpinner","whiteList","beforeEach","to","from","next","start","token","console","log","path","hasRoles","getters","roles","length","data","dispatch","accessedRoutes","addRoutes","replace","indexOf","done","afterEach"],"sources":["C:/Users/ht/Desktop/vue-express/src/router/permission/index.js"],"sourcesContent":["import router from '@/router/index.js'\r\n// import { Message } from 'element-ui'\r\nimport NProgress from 'nprogress'\r\nimport 'nprogress/nprogress.css'\r\nimport { getToken } from '@/utils/auth.js'\r\nimport store from '@/store'\r\nNProgress.configure({ showSpinner: false })\r\n// 白名单--所有权限均可访问的页面--登录和注册\r\nconst whiteList = ['/login', '/register']\r\nrouter.beforeEach(async (to, from, next) => {\r\n  /* must call `next` */\r\n  NProgress.start()\r\n  const token = getToken()\r\n  console.log(token)\r\n  if (token) {\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n    }\r\n    else {\r\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0\r\n      if (hasRoles) {\r\n        next()\r\n      }\r\n      else {\r\n        const data = await store.dispatch('user/getInfo')\r\n        const roles = data\r\n        const accessedRoutes = await store.dispatch('permission/generateRoutes', roles)\r\n        console.log(accessedRoutes)\r\n\r\n        router.addRoutes(accessedRoutes)\r\n        next({ ...to, replace: true })\r\n      }\r\n    }\r\n    // const roles = store.getters['user', 'roles\r\n    // resetRouter()\r\n    // console.log(router)\r\n  }\r\n  else {\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      next()\r\n    }\r\n    else {\r\n      next(`/login?redirect=${to.path}`)\r\n      NProgress.done()\r\n    }\r\n  }\r\n});\r\nrouter.afterEach(() => {\r\n  NProgress.done()\r\n})"],"mappings":"AAAA,OAAOA,MAAM,MAAM,mBAAmB;AACtC;AACA,OAAOC,SAAS,MAAM,WAAW;AACjC,OAAO,yBAAyB;AAChC,SAASC,QAAQ,QAAQ,iBAAiB;AAC1C,OAAOC,KAAK,MAAM,SAAS;AAC3BF,SAAS,CAACG,SAAS,CAAC;EAAEC,WAAW,EAAE;AAAM,CAAC,CAAC;AAC3C;AACA,MAAMC,SAAS,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC;AACzCN,MAAM,CAACO,UAAU,CAAC,OAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAC1C;EACAT,SAAS,CAACU,KAAK,CAAC,CAAC;EACjB,MAAMC,KAAK,GAAGV,QAAQ,CAAC,CAAC;EACxBW,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;EAClB,IAAIA,KAAK,EAAE;IACT,IAAIJ,EAAE,CAACO,IAAI,KAAK,QAAQ,EAAE;MACxBL,IAAI,CAAC;QAAEK,IAAI,EAAE;MAAI,CAAC,CAAC;IACrB,CAAC,MACI;MACH,MAAMC,QAAQ,GAAGb,KAAK,CAACc,OAAO,CAACC,KAAK,IAAIf,KAAK,CAACc,OAAO,CAACC,KAAK,CAACC,MAAM,GAAG,CAAC;MACtE,IAAIH,QAAQ,EAAE;QACZN,IAAI,CAAC,CAAC;MACR,CAAC,MACI;QACH,MAAMU,IAAI,GAAG,MAAMjB,KAAK,CAACkB,QAAQ,CAAC,cAAc,CAAC;QACjD,MAAMH,KAAK,GAAGE,IAAI;QAClB,MAAME,cAAc,GAAG,MAAMnB,KAAK,CAACkB,QAAQ,CAAC,2BAA2B,EAAEH,KAAK,CAAC;QAC/EL,OAAO,CAACC,GAAG,CAACQ,cAAc,CAAC;QAE3BtB,MAAM,CAACuB,SAAS,CAACD,cAAc,CAAC;QAChCZ,IAAI,CAAC;UAAE,GAAGF,EAAE;UAAEgB,OAAO,EAAE;QAAK,CAAC,CAAC;MAChC;IACF;IACA;IACA;IACA;EACF,CAAC,MACI;IACH,IAAIlB,SAAS,CAACmB,OAAO,CAACjB,EAAE,CAACO,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;MACrCL,IAAI,CAAC,CAAC;IACR,CAAC,MACI;MACHA,IAAI,CAAE,mBAAkBF,EAAE,CAACO,IAAK,EAAC,CAAC;MAClCd,SAAS,CAACyB,IAAI,CAAC,CAAC;IAClB;EACF;AACF,CAAC,CAAC;AACF1B,MAAM,CAAC2B,SAAS,CAAC,MAAM;EACrB1B,SAAS,CAACyB,IAAI,CAAC,CAAC;AAClB,CAAC,CAAC"}]}