{"remainingRequest":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\ht\\Desktop\\vue-express\\src\\router\\permission\\index.js","dependencies":[{"path":"C:\\Users\\ht\\Desktop\\vue-express\\src\\router\\permission\\index.js","mtime":1696653716788},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\babel.config.js","mtime":1696052669664},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1696052662415},{"path":"C:\\Users\\ht\\Desktop\\vue-express\\node_modules\\babel-loader\\lib\\index.js","mtime":1696052663280}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHJvdXRlciBmcm9tICdAL3JvdXRlci9pbmRleC5qcyc7Ci8vIGltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tICdlbGVtZW50LXVpJwppbXBvcnQgTlByb2dyZXNzIGZyb20gJ25wcm9ncmVzcyc7CmltcG9ydCAnbnByb2dyZXNzL25wcm9ncmVzcy5jc3MnOwppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJ0AvdXRpbHMvYXV0aC5qcyc7CmltcG9ydCBzdG9yZSBmcm9tICdAL3N0b3JlJzsKTlByb2dyZXNzLmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOwovLyDnmb3lkI3ljZUtLeaJgOacieadg+mZkOWdh+WPr+iuv+mXrueahOmhtemdoi0t55m75b2V5ZKM5rOo5YaMCmNvbnN0IHdoaXRlTGlzdCA9IFsnL2xvZ2luJywgJy9yZWdpc3RlciddOwpyb3V0ZXIuYmVmb3JlRWFjaChhc3luYyAodG8sIGZyb20sIG5leHQpID0+IHsKICAvKiBtdXN0IGNhbGwgYG5leHRgICovCiAgTlByb2dyZXNzLnN0YXJ0KCk7CiAgY29uc3QgdG9rZW4gPSBnZXRUb2tlbigpOwogIGNvbnNvbGUubG9nKHRva2VuKTsKICBpZiAodG9rZW4pIHsKICAgIGlmICh0by5wYXRoID09PSAnL2xvZ2luJykgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnLycKICAgICAgfSk7CiAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBoYXNSb2xlcyA9IHN0b3JlLmdldHRlcnMucm9sZXMgJiYgc3RvcmUuZ2V0dGVycy5yb2xlcy5sZW5ndGggPiAwOwogICAgICBjb25zb2xlLmxvZyhoYXNSb2xlcyk7CiAgICAgIGlmIChoYXNSb2xlcykgewogICAgICAgIG5leHQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgc3RvcmUuZGlzcGF0Y2goJ3VzZXIvZ2V0SW5mbycpOwogICAgICAgIGNvbnN0IHJvbGVzID0gZGF0YS5yb2xlOwogICAgICAgIGNvbnN0IGFjY2Vzc2VkUm91dGVzID0gYXdhaXQgc3RvcmUuZGlzcGF0Y2goJ3Blcm1pc3Npb24vZ2VuZXJhdGVSb3V0ZXMnLCByb2xlcyk7CiAgICAgICAgY29uc29sZS5sb2coYWNjZXNzZWRSb3V0ZXMpOwogICAgICAgIHJvdXRlci5hZGRSb3V0ZXMoYWNjZXNzZWRSb3V0ZXMpOwogICAgICAgIG5leHQoewogICAgICAgICAgLi4udG8sCiAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8vIGNvbnN0IHJvbGVzID0gc3RvcmUuZ2V0dGVyc1sndXNlcicsICdyb2xlcwogICAgLy8gcmVzZXRSb3V0ZXIoKQogICAgLy8gY29uc29sZS5sb2cocm91dGVyKQogIH0gZWxzZSB7CiAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoYC9sb2dpbj9yZWRpcmVjdD0ke3RvLnBhdGh9YCk7CiAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICB9CiAgfQp9KTsKcm91dGVyLmFmdGVyRWFjaCgoKSA9PiB7CiAgTlByb2dyZXNzLmRvbmUoKTsKfSk7"},{"version":3,"names":["router","NProgress","getToken","store","configure","showSpinner","whiteList","beforeEach","to","from","next","start","token","console","log","path","done","hasRoles","getters","roles","length","data","dispatch","role","accessedRoutes","addRoutes","replace","indexOf","afterEach"],"sources":["C:/Users/ht/Desktop/vue-express/src/router/permission/index.js"],"sourcesContent":["import router from '@/router/index.js'\r\n// import { Message } from 'element-ui'\r\nimport NProgress from 'nprogress'\r\nimport 'nprogress/nprogress.css'\r\nimport { getToken } from '@/utils/auth.js'\r\nimport store from '@/store'\r\nNProgress.configure({ showSpinner: false })\r\n// 白名单--所有权限均可访问的页面--登录和注册\r\nconst whiteList = ['/login', '/register']\r\nrouter.beforeEach(async (to, from, next) => {\r\n  /* must call `next` */\r\n  NProgress.start()\r\n  const token = getToken()\r\n  console.log(token)\r\n  if (token) {\r\n    if (to.path === '/login') {\r\n      next({ path: '/' })\r\n      NProgress.done()\r\n    }\r\n    else {\r\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0\r\n      console.log(hasRoles)\r\n      if (hasRoles) {\r\n        next()\r\n      }\r\n      else {\r\n        const data = await store.dispatch('user/getInfo')\r\n        const roles = data.role\r\n        const accessedRoutes = await store.dispatch('permission/generateRoutes', roles)\r\n        console.log(accessedRoutes)\r\n\r\n        router.addRoutes(accessedRoutes)\r\n        next({ ...to, replace: true })\r\n      }\r\n    }\r\n    // const roles = store.getters['user', 'roles\r\n    // resetRouter()\r\n    // console.log(router)\r\n  }\r\n  else {\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      next()\r\n    }\r\n    else {\r\n      next(`/login?redirect=${to.path}`)\r\n      NProgress.done()\r\n    }\r\n  }\r\n});\r\nrouter.afterEach(() => {\r\n  NProgress.done()\r\n})"],"mappings":"AAAA,OAAOA,MAAM,MAAM,mBAAmB;AACtC;AACA,OAAOC,SAAS,MAAM,WAAW;AACjC,OAAO,yBAAyB;AAChC,SAASC,QAAQ,QAAQ,iBAAiB;AAC1C,OAAOC,KAAK,MAAM,SAAS;AAC3BF,SAAS,CAACG,SAAS,CAAC;EAAEC,WAAW,EAAE;AAAM,CAAC,CAAC;AAC3C;AACA,MAAMC,SAAS,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC;AACzCN,MAAM,CAACO,UAAU,CAAC,OAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EAC1C;EACAT,SAAS,CAACU,KAAK,CAAC,CAAC;EACjB,MAAMC,KAAK,GAAGV,QAAQ,CAAC,CAAC;EACxBW,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;EAClB,IAAIA,KAAK,EAAE;IACT,IAAIJ,EAAE,CAACO,IAAI,KAAK,QAAQ,EAAE;MACxBL,IAAI,CAAC;QAAEK,IAAI,EAAE;MAAI,CAAC,CAAC;MACnBd,SAAS,CAACe,IAAI,CAAC,CAAC;IAClB,CAAC,MACI;MACH,MAAMC,QAAQ,GAAGd,KAAK,CAACe,OAAO,CAACC,KAAK,IAAIhB,KAAK,CAACe,OAAO,CAACC,KAAK,CAACC,MAAM,GAAG,CAAC;MACtEP,OAAO,CAACC,GAAG,CAACG,QAAQ,CAAC;MACrB,IAAIA,QAAQ,EAAE;QACZP,IAAI,CAAC,CAAC;MACR,CAAC,MACI;QACH,MAAMW,IAAI,GAAG,MAAMlB,KAAK,CAACmB,QAAQ,CAAC,cAAc,CAAC;QACjD,MAAMH,KAAK,GAAGE,IAAI,CAACE,IAAI;QACvB,MAAMC,cAAc,GAAG,MAAMrB,KAAK,CAACmB,QAAQ,CAAC,2BAA2B,EAAEH,KAAK,CAAC;QAC/EN,OAAO,CAACC,GAAG,CAACU,cAAc,CAAC;QAE3BxB,MAAM,CAACyB,SAAS,CAACD,cAAc,CAAC;QAChCd,IAAI,CAAC;UAAE,GAAGF,EAAE;UAAEkB,OAAO,EAAE;QAAK,CAAC,CAAC;MAChC;IACF;IACA;IACA;IACA;EACF,CAAC,MACI;IACH,IAAIpB,SAAS,CAACqB,OAAO,CAACnB,EAAE,CAACO,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;MACrCL,IAAI,CAAC,CAAC;IACR,CAAC,MACI;MACHA,IAAI,CAAE,mBAAkBF,EAAE,CAACO,IAAK,EAAC,CAAC;MAClCd,SAAS,CAACe,IAAI,CAAC,CAAC;IAClB;EACF;AACF,CAAC,CAAC;AACFhB,MAAM,CAAC4B,SAAS,CAAC,MAAM;EACrB3B,SAAS,CAACe,IAAI,CAAC,CAAC;AAClB,CAAC,CAAC"}]}